<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication Application using Javascript and local storage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/navbar-fixed/">
    <link href="./css/minu_style.css" rel="stylesheet">
    <link href="../users/bootstrap/assets/dist/css/bootstrap.min.css" rel="stylesheet">
    <script  src="./js/minu.js"></script>
</head>

<body class="text-left">
    <div class="container">
      <div id="included-mimu"></div>
    </div>
    <div class="container" style="width: 100%; border: 0px solid #ccc;">
        <h5 style="text-align: center;">Group Chat</h5>
    </div>
    <div style="width: 100%; margin-top: 20px; margin-bottom: 20px;">
        &nbsp;
    </div>
    <div class="container" id="chatContainer" style="width: 100%; max-height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;"></div>

    <div class="container" style="width: 100%; float:center;margin:20px; padding:20px;">
        <div style="width: 70%; float:left;margin-left: 2%;">
            <input style="width: 70%;margin:20px; padding:20px;" type="text" id="messageInput" placeholder="Type a message...">
        </div>
        <div style="width: 18%; float:left; margin:20px; padding:20px;">
            <button style="width: 90%; height: 50px;" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadChats();
        });

        function loadChats() {
            const chkloggedInUser = JSON.parse(localStorage.getItem('login_user'));
            if (!chkloggedInUser) {
                alert("No user is logged in");
                window.location.href = "login.html";
                return;
            }
            const chatContainer = document.getElementById('chatContainer');
            const chats = JSON.parse(localStorage.getItem('chats')) || [];
            chatContainer.innerHTML = '';

            // Sort chats by date
            chats.sort((a, b) => new Date(a.date) - new Date(b.date));

            chats.forEach(chat => {
                const chatDiv = document.createElement('div');
                chatDiv.innerText = `${chat.user}: ${chat.message} (${chat.date})`;
                chatContainer.appendChild(chatDiv);
            });

            // Scroll to the bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');

            //JSON.stringify(login_user)
            if (messageInput.value.trim()) {
                const loggedInUser = JSON.parse(localStorage.getItem('login_user'));
                if (!loggedInUser) {
                    alert("No user is logged in");
                    return;
                }
                
                const chats = JSON.parse(localStorage.getItem('chats')) || [];
                chats.push({
                    user: loggedInUser[0].fullname,
                    message: messageInput.value.trim(),
                    date: new Date().toLocaleString()
                });
                localStorage.setItem('chats', JSON.stringify(chats));
                messageInput.value = ''; // Clear the input field
                loadChats(); // Reload the chat messages
            }
        }
    </script>
</body>

</html>
